{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Arrivals by Purpose Jan 2015 Onwards",
  "data": { "url": "data/Visit_reasons_long.csv" },
  "config": {
    "view": {"stroke": null},
    "facet": {"spacing": 5},
    "axis": {"domain": false},
    "title": {"anchor": "start", "fontSize": 18}
  },
  "facet": {
    "row": {
      "field": "Purpose",
      "type": "nominal",
      "header": {"labelAngle": 0, "labelAlign": "left", "labelFontSize": 13},
      "title": null
    }
  },
  "spec": {
    "width": 650,
    "height": 70,
    "mark": {
      "type": "area",
      "interpolate": "monotone",
      "fillOpacity": 0.8,
      "stroke": "lightgray",
      "strokeWidth": 0.5
    },
    "encoding": {
      "x": {
        "field": "MonthParsed",
        "type": "temporal",
        "title": "Month",
        "axis": {"format": "%b %Y", "labelAngle": -45, "labelFontSize": 10}
      },
      "y": {
        "field": "Percent",
        "type": "quantitative",
        "title": "% of Total Arrivals",
        "scale": {"range": [50, -50]},
        "axis": null
      },
      "fill": {
        "field": "Percent",
        "type": "quantitative",
        "scale": {"scheme": "blues"},
        "legend": null
      },
      "tooltip": [
        {"field": "Purpose"},
        {"field": "Month", "type": "nominal"},
        {"field": "Percent", "type": "quantitative", "format": ".1f"}
      ]
    },
    "transform": [
      {"calculate": "timeParse(datum.Month, '%b-%Y')", "as": "MonthParsed"},
      {
        "lookup": "Month",
        "from": {
          "data": { "url": "data/Visit_reasons_long.csv" },
          "key": "Month",
          "fields": ["Count"]
        },
        "as": "TotalCount"
      },
      {"filter": "datum.Purpose != 'Total'"},
      {"filter": "datum.MonthParsed >= datetime(2015, 0, 1)"},
      {"calculate": "(datum.Count / datum.TotalCount) * 100", "as": "Percent"}
    ]
  },
  "bounds": "flush"
}
